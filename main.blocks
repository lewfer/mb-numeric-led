<xml xmlns="https://developers.google.com/blockly/xml"><block type="pxt-on-start" id="546UESZJD2F{op6}8d}X" x="0" y="0"><statement name="HANDLER"><block type="typescript_statement" id="(id_IhPw9`a18/!dC.h!" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="namespace segment_led {" line1="    let DEFAULT_ADDRESS = 0x70;" line2="    let HT16K33_BLINK_CMD = 0x80" line3="    let HT16K33_BLINK_DISPLAYON = 0x01" line4="    let HT16K33_BLINK_OFF = 0x00" line5="    let HT16K33_BLINK_2HZ = 0x02" line6="    let HT16K33_BLINK_1HZ = 0x04" line7="    let HT16K33_BLINK_HALFHZ = 0x06" line8="    let HT16K33_SYSTEM_SETUP = 0x20" line9="    let HT16K33_OSCILLATOR = 0x01" line10="    let HT16K33_CMD_BRIGHTNESS = 0xE0" line11="" line12="    let usedi2cAddress: number = DEFAULT_ADDRESS;" line13="" line14="    let buffer = pins.createBuffer(17);" line15="" line16="    let chars: { [key: string]: number } = { ' ': 0, '!': 6, '&quot;': 544, '#': 4814, '$': 4845, '%': 3108, '&amp;': 9053, &quot;'&quot;: 1024, '(': 9216, ')': 2304, '*': 16320, '+': 4800, ',': 2048, '-': 192, '.': 0, '/': 3072, '0': 3135, '1': 6, '2': 219, '3': 143, '4': 230, '5': 8297, '6': 253, '7': 7, '8': 255, '9': 239, ':': 4608, ';': 2560, '&lt;': 9216, '=': 200, '&gt;': 2304, '?': 4227, '@': 699, 'A': 247, 'B': 4751, 'C': 57, 'D': 4623, 'E': 249, 'F': 113, 'G': 189, 'H': 246, 'I': 4608, 'J': 30, 'K': 9328, 'L': 56, 'M': 1334, 'N': 8502, 'O': 63, 'P': 243, 'Q': 8255, 'R': 8435, 'S': 237, 'T': 4609, 'U': 62, 'V': 3120, 'W': 10294, 'X': 11520, 'Y': 5376, 'Z': 3081, '[': 57, '\\': 8448, ']': 15, '^': 3075, '_': 8, '`': 256, 'a': 4184, 'b': 8312, 'c': 216, 'd': 2190, 'e': 2136, 'f': 113, 'g': 1166, 'h': 4208, 'i': 4096, 'j': 14, 'k': 13824, 'l': 48, 'm': 4308, 'n': 4176, 'o': 220, 'p': 368, 'q': 1158, 'r': 80, 's': 8328, 't': 120, 'u': 28, 'v': 8196, 'w': 10260, 'x': 10432, 'y': 8204, 'z': 2120, '{': 2377, '|': 4608, '}': 9353, '~': 1312 };" line17="" line18="    let digits: { [key: string]: number } = { ' ': 0, '-': 64, '0': 63, '1': 6, '2': 91, '3': 79, '4': 102, '5': 109, '6': 125, '7': 7, '8': 127, '9': 111, 'A': 119, 'B': 124, 'C': 57, 'D': 94, 'E': 121, 'F': 113 };" line19="" line20="    /**" line21="     * Segment LED Display" line22="     */" line23="    //% blockId=initialise_set_i2c_address" line24="    //% block=&quot;set i2c address %i2cAddress&quot;" line25="    export function set_i2c_address(i2cAddress: number): void {" line26="        usedi2cAddress = i2cAddress" line27="    }" line28="" line29="    //% blockId=initialise led_display" line30="    //% block=&quot;initialse led display&quot;" line31="    export function initialise_led_display(): void {" line32="" line33="        // Init" line34="        pins.i2cWriteNumber(" line35="            usedi2cAddress," line36="            HT16K33_SYSTEM_SETUP | HT16K33_OSCILLATOR," line37="            NumberFormat.UInt8LE," line38="            false" line39="        )" line40="        // Blink rate" line41="        pins.i2cWriteNumber(" line42="            usedi2cAddress," line43="            HT16K33_BLINK_CMD | 1," line44="            NumberFormat.UInt8LE," line45="            false" line46="        )" line47="        // Brightness" line48="        pins.i2cWriteNumber(" line49="            usedi2cAddress," line50="            HT16K33_CMD_BRIGHTNESS | 0," line51="            NumberFormat.UInt8LE," line52="            false" line53="        )" line54="    }" line55="" line56="    /**" line57="     * AWrite raw bits to turn on individual segments" line58="     */" line59="    //% blockId=alphanum_write_raw" line60="    //% block=&quot;write raw %bitmask at %position&quot;" line61="    //% position.min=0 position.max=3" line62="    export function write_raw(bitmask: number, position: number): void {" line63="        buffer[1 + position * 2] = bitmask &amp; 0xff" line64="        buffer[1 + position * 2 + 1] = (bitmask &gt;&gt; 8) &amp; 0xff" line65="    }" line66="" line67="    //% blockId=alphanum_update_display" line68="    //% block=&quot;update display&quot;" line69="    export function update_display(): void {" line70="        pins.i2cWriteBuffer(usedi2cAddress, buffer, false)" line71="    }" line72="" line73="    //% blockId=alphanum_clear_display" line74="    //% block=&quot;clear display&quot;" line75="    export function clear_display(): void {" line76="        for (let index = 0; index &lt;= 16; index++) {" line77="            buffer[index] = 0" line78="        }" line79="    }" line80="" line81="    //% blockId=alphanum_set_character" line82="    //% block=&quot;set character %character at %position&quot;" line83="    //% position.min=0 position.max=3" line84="    export function set_character(character: string, position: number): void {" line85="        write_raw(position, chars[character])" line86="    }" line87="" line88="    //% blockId=alphanum_set_string" line89="    //% block=&quot;set string %characters&quot;" line90="    export function set_string(character: string): void {" line91="        write_raw(0, chars[character.charAt(0)])" line92="        write_raw(1, chars[character.charAt(1)])" line93="        write_raw(2, chars[character.charAt(2)])" line94="        write_raw(3, chars[character.charAt(3)])" line95="" line96="    }" line97="" line98="    //% blockId=alphanum_set_digit" line99="    //% block=&quot;set digit %digit at %position&quot;" line100="    //% position.min=0 position.max=3" line101="    export function set_digit(digit: number, position: number): void {" line102="        write_raw(position, digits[digit])" line103="    }" line104="}" numlines="105"></mutation></block></statement></block></xml>